# Лабораторная работа №10. Тема: "Мандатный контроль целостности в Astra Linux Special Edition"

Цель работы
----------
- Изучить мандатный контроль целостности в Astra Linux Special Edition.


Оборудование, ПО:
----------

Виртуальная машина или компьютер под управлением ОС AstraLinux 1.7 в режиме защищенности "Воронеж" или выше.

Чтобы выполнять задачи по администрированию в Astra Linux мандатного контроля целостности, ваша учетная запись должна иметь следующие настройки:

* Запускать команды и процессы от имени учетной записи суперпользователя root;

Помните, что во время установки ОС Astra Linux создается учетная запись группы astra-admin. Включенным в эту группу учетным записям разрешено выполнять команды от имени суперпользователя root с помощью консольной утилиты **sudo**.

* Запускать команды и процессы с уровнем целостности "Высокий".

Для использования команд с уровнем целостности "Высокий" учетной записи должны быть назначен соответствующий уровень целостности. Сделать это можно: 

1) С использованием команды **pdpl-user**. Синтаксис следующий: 

```
pdpl-user -i [требуемый уровень целостности] [имя_учетной_записи]
```

Например, для пользователя ansible команда была бы: 

```
pdpl-user -i 63 ansible
```

2) С помощью программы "Политика безопасности" в меню Пуск или по запуску командой - 

```
fly-admin-smc
```

![Картинка](./Screen1.png)


Ход работы:
----------

# Что будем делать сейчас?

В данной лабораторной работе мы обсудим как администрировать МКЦ в Astra Linux.

Как его включить? 

Предположим, что до этой лабораторной работы вы МКЦ не включал, сделать это можно:

1) Консольной утилитой **set-fs-ilev**. Данная утилита позволяет: 

  * Узнать текущее состояние защиты файловой системы с использованием МКЦ:
  
    ```
    set-fs-ilev status
    ```

![Картинка](Screen1.png)


  * Включить или выключить МКЦ на файловой системе: 

  ```
  set-fs-ilev enable 
  ```
  
  Или

  ```
  set-fs-ilev disable 
  ```

  * Получить список каталогов, в которых будет включен МКЦ после работы:

  ```
  set-fs-ilev  defconfig
  ```

Список каталогов, в которых будет включен МКЦ, хранится в конфигурационном файле - **/etc/parsec/fs-ilev.conf**.


# Отправляемся трудиться!

Первым делом, создадим УЗ - linuxuser. 

```
sudo adduser linuxuser
```

![Картинка](Screen2.png)

Далее добавим его в группу astra-admin

```
sudo usermod -a linuxuser -G astra-admin
```

А проверить можем вот так - 

```
id linuxuser
```

![Картинка](Screen3.png)


Затем необходимо назначить максимальный уровень целостности - 

```
sudo pdpl-user -i 63 linuxuser
```

![Картинка](Screen4.png)

## Проверить правильность выполнения задания просто - попробуйте зайти под linuxuser в режим высокого уровня целостности.

Теперь, мы получили (или закрепили) навык создания локальных учетных записей администратора.

# А что же дальше? 

Теперь, пора поработать с файловой системой в рамках МКЦ.

Обратимся к терминологии из документации:

"В соответствии с правилами МКЦ уровень целостности каталога не может быть ниже уровня целостности содержащихся в нем сущностей (файлов и подкаталогов) файловой системы. При этом даже процессы от имени администратора безопасности Astra Linux на уровне целостности "Высокий" не могут обойти данное ограничение.

Создание и\или удаление сущностей файловой системы связано с внесением изменений в структуру и содержание каталога, т.е. соответствует доступу на запись в него. В связи с этим правилами МКЦ осуществление таких действий разрешено только при условии, что уровень целостности субъекта (процесса) не ниже уровня целостности целевого каталога или файла"

Для просмотра или изменения уровня целостности файлов или каталогов используется:

1) Утилита pdpl-file.

Синтаксис использования утилиты следующий:

```
pdpl-file [параметры] [уровень] [:уровень_целостности[:категория[:флаги]]] [сущность]
```

Разберем на реальном примере.

Если вы планируете назначить высокий уровень целостности для каталога /tmp, команда будет такой:

```
sudo pdpl-file  :63 /tmp
```

А как посмотреть настройки целостности на файл? 

```
sudo pdpl-file /tmp
```

![Картинка](Screen5.png)

# Еще немного практики? 

Создайте самостоятельно каталоги и укажите им уровень целостности, в соответствии с таблицей:

| Каталог | Уровень целостности 
| ------- | ------------------- 
| /folder_new  | Высокий(63) 
| /folder_new/Dir1 | Низкий (0) 
| /folder_new/Dir2  | Сетевые сервисы (1)  
| /folder_new/Dir3  | Высокий(63) 

Затем создайте пользователя с низким уровнем целостности, например, liluser.

Проверить, что каталогам назначены правильные настройки можно так -

![Картинка](Screen6.png)

А теперь, для того чтобы действительно убедиться в работе МКЦ. Введите команду - 

```
sudo chmod 777 -R /folder_new
```

С помощью данной команды, мы назначаем дискреционные права доступа ко всем каталогам созданной иерархии для обеспечения полного доступа (rwx) к ним для всех учетных записей пользователей.


Затем, давайте зайдем в систему под нашим пользователем liluser и проверим, что он может делать с нашими каталогами.

![Картинка](Screen7.png)

Доступа нет, что и требовалось доказать.

# Пробуем повысить уровень целостности пользователя liluser до уровня уровня "Сетевые сервисы".

Перейдите в учетную запись администратора и повысьте привилегии командой -

```
sudo pdpl-user -i 1 liluser
```

![Картинка](Screen8.png)

Войти в систему под новым пользователем можно вот так - 

![Картинка](Screen9.png)


Проверяем, куда мы можем вносить корректировки в нашей файловой иерархии - 

![Картинка](Screen10.png)

Имея 1 уровень целостности мы можем вносить корректировки в директориях, на одном с нами уровне целостности, а также на нижних. Выше доступа нет, не смотря на максимальные права доступа в дискреционной системе  прав Linux.

# Вроде разобрались, а что теперь? 

Пора познакомиться с уровнями конфиденциальности!

Обратимся к документации: 

"Для просмотра, переименования и добавления в Astra Linux уровней конфиденциальности и неиерархических категорий можно использовать консольные утилиты  **userlev** и **usercat** соответственно или графическую утилиту "Управление политикой безопасности" (категория "Мандатные атрибуты" в боковой панели навигации)"

Назначить уровень конфиденциальности можно с помощью:

1) консольной утилиты pdpl-user;

2) графической утилиты "Управление политикой безопасности" (fly-admin-smc);

    * Стоит дополнить, что при использовании графической утилиты fly-admin-smc алгоритм работы можно описать так:

      - Запустить

      



































# Заключение

В результате прохождения данного курса вы приобрели необходимые навыки для эффективного управления конфигурациями хостов с помощью Ansible. Мы освоили основные концепции и инструменты Ansible, освоили методы автоматизации управления конфигурациями, научились создавать playbooks и роли, а также выполнять управление хостами. Данная лабораторная работа позволила участникам углубить свои знания и навыки в области управления конфигурациями, что будет полезно для их дальнейшей профессиональной деятельности.

Безусловно, мы бы не смогли в полной мере обсудить данный инструмент - он имеет широкое применение и инструментарий, но сформировать базовое представление об инструменте точно смогли!

В следующем материале вы познакомитесь с темой  - Мандатный контроль целостности в Astra Linux Special Edition.

Благодарю за чтение и успехов вам в обучении!


# Дополнительная информация:
1) Руководство по YAML [Ссылка](https://wiki.merionet.ru/articles/rukovodstvo-po-yaml-vse-chto-vam-nuzhno-znat-za-5-minut)
2) YAML - что за зверь?  [Ссылка](https://habr.com/ru/articles/710414/)
3) Модуль APT в Ansible. Документация  [Ссылка](https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html)
4) Ansible Vault [Ссылка](https://docs.ansible.com/ansible/2.9/user_guide/vault.html)
5) Ansible для начинающих[Ссылка](https://habr.com/ru/companies/slurm/articles/714000/)
6) Ansible. Основы.. Видео на русском. [Ссылка](https://www.youtube.com/watch?v=n27bpkAtyf4&ab_channel=Unixway)